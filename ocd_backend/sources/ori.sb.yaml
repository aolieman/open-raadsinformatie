# All underscored root keys are excluded
_defaults: &source_defaults
  hidden: false
  keep_index_on_update: true
  wait_until_finished: false

_entity_defaults: &entity_defaults
  id: "{index_name}_{entity}"
  transformer: ocd_backend.transformers.transformer
  loaders:
    - ocd_backend.loaders.elasticsearch.elasticsearch_loader
    - ocd_backend.loaders.delta.delta_loader
  cleanup: ocd_backend.tasks.cleanup_elasticsearch

_entities: &entities
  - &municipality
    <<: *entity_defaults
    entity: municipality
    doc_type: organizations
    extractor: ocd_backend.extractors.allmanak.AllmanakMunicipalityExtractor
    item: ocd_backend.items.organizations.MunicipalityOrganizationItem

  - &committees
    <<: *entity_defaults
    entity: committees
    doc_type: organizations
    extractor: ocd_backend.extractors.simbestuur.SimBestuurCommitteesExtractor
    item: ocd_backend.items.simbestuur.SimBestuurCommitteeItem

  - &organizations
    <<: *entity_defaults
    entity: organizations
    doc_type: organizations
    extractor: ocd_backend.extractors.allmanak.AllmanakPartiesExtractor
    item: ocd_backend.items.organizations.PartyItem

  - &persons
    <<: *entity_defaults
    entity: persons
    doc_type: persons
    extractor: ocd_backend.extractors.allmanak.AllmanakPersonsExtractor
    item: ocd_backend.items.persons.AllmanakPersonItem

  - &meetings
    <<: *entity_defaults
    entity: meetings
    doc_type: events
    extractor: ocd_backend.extractors.simbestuur.SimBestuurMeetingsExtractor
    item: ocd_backend.items.simbestuur.SimBestuurMeetingItem
    enrichers:
    - - ocd_backend.enrichers.media_enricher.static.local_static_media_enricher
      - tasks:
        - file_to_text

    # TODO: Add reports?

_sb: &sb
  index_name: "{key}"
  sitename: "{key!c}"
  allmanak_api_version: "v0"
  entities: *entities
  <<: *source_defaults

# TODO: These are just examples, not real SB municipalities
ori.sb:
  goirle:
    key: goirle
    base_url: "https://raad.goirle.nl/api"
    allmanak_id: 30496
    <<: *sb

  den_helder:
    key: den_helder
    base_url: "https://gemeenteraad.denhelder.nl/api"
    allmanak_id: 24611
    <<: *sb
